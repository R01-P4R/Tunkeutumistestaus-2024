# x)

 
 
 
 
##    Lyon 2009: Nmap Network Scanning: Chapter 15. Nmap Reference Guide (https://nmap.org/book/man-port-scanning-basics.html)

Nmapin ohjeessa käsitellään eri termejä liittyen porttiskannaukseen.

* Nmap tunnistaa kuusi eri tilaa porteille: avoin, suljettu, suodatettu, suodattamaton, avoin|suodatettu ja suljettu|suodattu.

* Avoin tila tarkoittaa, että kohde (portti) ottaa vastaan liikennettä TCP:ltä, UDP:ltä ja STCP:ltä. Avointen porttien etsiminen on yleensä porttiskannauksen päätavoite.

* Suljettu portti ottaa vastaan tietoa, mutta mikään sovellus ei kuuntele sitä.

* Suodatettu porttia Nmap ei pysty varmistamaan avoimeksi, sillä yleensä esimerkiksi, tulimuurit estävät pakettien saapumisen porttiin.

* Suodattamaton portti tarkoittaa, että porttiin saadaan yhteys, mutta Nmap ei pysty määrittämään onko portti auki vai suljettu.

* Avoin|suodatettu kategoria kuuluu niille porteille, jota Nmap ei pysty sijoittamaan suodatettuun tai avoimeen tilaan.

* Suljettu|suodattu kategoria on niille porteille jotka ovat joka suljettuja tai suodatettuja. 

##    Port Scanning Techniques (https://nmap.org/book/man-port-scanning-techniques.html)

Nmapin ohjeessa käsitellään eri porttiskannaukseen liittyviä tekniikoita.

* -sS (TCP SYN scan) on yleisin porttiskannaus menetelmä, joka lähettää nopeasti SYN-paketteja  ja saa vastaukseski joko A SYN/ACK- paketin (avoin portti) tai RST-paketilla (suljettu). Jos portti ei vastaa tietyn aikavälin sisällä, niin se merkitään suodatetuksi.

* -sT (TCP connect scan) menetelmää käytetään, kun -sS -skannausta ei voida suorittaa. -sT -skannaus pyrkii muodostamaan yhteyden kohteeseen connect-menetelmällä, jota esimerkiksi selaimet käyttävät. -st -skannauksesta yleensä jää myös helpommin jälkiä ja se on hitaampaa ja vaatii enemmän pakettien lähettämistä.

* -sU (UDP scans) menetelmässä lähetetään SYN-pakettien sijasta UDP-paketteja kohteeseen, minkä avulla voidaan kiertää mahdollisa ylenkatsomisia tietoturvassa.  

##    KKO:2003:36 Tietomurto Vahingonkorvaus - Korvauksen sovittelu 
(https://finlex.fi/fi/oikeus/kko/kko/2003/20030036)

Korkeimman oikeuden pöytäkirjassa käsitellään Osuuspankkikeskukseen kohdistuvaa porttiskannausta.

* Henkilö A oli suorittanut porttiskannauksen Osuuspankkikeskus-OPK osuuskunnan tietojärjestelmään, tarkoituksenaan löytää avoimia välityspalvelimia.

* Skannaus ei ollut kuitenkaan läpäissyt tietojärjestelmän palomuuria.

* Tutkinnassa kävi ilmi, että porttiskannaus oli suoritettu henkilön A koneelta, mistä löytyi myös työkaluja porttiskannaukseen, sekä dataa porttiskannaukseen liittyen.

* Henkilö A joutui maksamaan sakkoja korvaukseksi rikkeestään, sillä oikeus katsoi, että henkilöllä A oli tietämystä tietoturvasta ja sen tuoma vastuu.

  
   
   
 # H2
 
 Harjoituksen tarkoituksena on asentaa virtuaalikoneen verkko ja suorittaa porttiskannauksia  

 
 
### Laitteisto
 
* Käyttöjärjestelmä	Microsoft Windows 10 Enterprise LTSC 64 bit
* Prosessori i5-6600
* RAM 16 GB
* Virtuaaliohjelmisto : Oracle VM VirtualBox
* Virtuaali käyttöjärjestelmä: Kali 2024.1 - 28th February, 2024 - The first 2024 Kali Rolling release. Kernel 6.6.0, Xfce 4.18.4


## A) Kalin asennus virtuaalikoneeseen

Olin viimeharjoituksessa (H1, kotha E : https://github.com/R01-P4R/Tunkeutumistestaus-2024/blob/main/H1.md) asentanut jo Kalin virtuaaliympäristöön. 


## B) Metasploitable 2 

  Asennetaan Metasploitable 2 virtuaalikoneeseen. 

  Aloitin lataamalla Metasploitable 2:n uusimman tiedoston osoitteesta: (https://sourceforge.net/projects/metasploitable/) Tiedosto sisältää virtuaalikovalevyn, joten ISO-tiedostoa ei tarvitse erikseen.

Sen jälkeen siirryin luomaan uutta virtuaalikonetta, seuraavilla asetuksilla:








 


## C) Virtuualiverkko

Luodaan virtuaalikoneille oma host-only -virtuaaliverko, joka eristää koneet muusta verkosta.

Aloitin luomalla uuden virtuaaliverkon virtuaaliboksissa ja lisäsin siihen Kali-virtuaalikoneen (Kalkuta) ja Metasploitable 2:n (Meta):


Testasin ensin Kalilla ja sitten Metasploitablella että en saa yhteyttä verkkoon komennoilla:

    $ ping 1.1.1.1
    $ ping www.duckduckgo.com
    $ curl www.google.com

Kirjauduin sisään Metasploitableen vakiotunnuksilla ja testasin yhteyttä samoilla komennoilla:



Hyvältä näyttää. Tarkistin, että myös Kali sai yhteyden Metasploitableen. Selvitin Metan salasanan komennolla:

    $ ifconfig


Kalissa pingasin kyseistä osoitetta.






 ## D) Metasploitable porttiskannaus
Suoritetaan porttiskannaus Metasploitableen. Seurataan skannausta Wiresharkilla. //Varmistathan, että koneet eivät ole kytkennässä internettiin.


Aloitin suorittamalla komennon:

    $ nmap 192.168.56.101 -sn  

Wiresharkissa näkyi skannauksen eri vaiheita TCP- ja ARP-kyselyt.


Tarkistin vielä skannatun Ip-osoitteen käyttämällä komentoa:

    $ curl 192.168.56.101





## E) Laajempi skannaus 

Tehdään laajempi skannaus Metasploitableen ja seurataan skannausta Wiresharkilla.

Aloitin suorittamalla komennon:

   $ nmap 192.168.56.101 -A -p0-


Skannaus tuotti paljon tuloksia oheessa muutamia esille tulleita seikkoja:

  * Lukuisia portteja ja niisä olevia palveluita on auki mm. FTP/21, SSH/22, MYSQL/3306, APACHE/80. 

  * FTP:ssä sallitaan anonyymi-sisäänkirjautuminen, mikä luultavasti auttaisi mahdollisesti piilottaaman tunkeutumisen jälkiä.

  * Wiresharkissa oli huomattavasti enemmän erillaisia paketteja mm. VNC, MySQL, HTTP, SMTP, Portmap.

  

## F) Porttiskannauksen tulosten tallentaminen

Tallennetaan portttiskannauksen tulokset käyttäen Nmpain omaa työkalua.

Aloitin suorittamalla komennon:

    $ nmap 192.168.56.101 -oA scan

Joka tallentaa skannuksen tulokset tiedostonimella ‘scan’.



## G) Shell-session tallenus tekstitiedostoon

Tallenetaan shell-sessio tekstitedostoon hyödyntäen script-työkalua.

Käytin komentoa:

    $ script -fa log001.txt

Luodakseni lokitiedoston.

## H) Tulosten etsimistä

Etsitään aikaisemmin tallenetuista lokeista tuloksia.

Suoritin komennon:

   $ grep -ir 192.168.56.101   //Metasploit-koneen IP-osoite


Hyödillistä, kun lokeja on paljon.


## J) Nmapin ajonaikaiset komennot

Testataan Nmapin ajonaikana käytettäviä komentoja. Nnmapin ajon aikana voi esimerkiksi ottaa paketin jäljittimen päälle ja pois kirjaimilla p/P. (https://nmap.org/book/man-runtime-interaction.html)

Aloitin Nmap-skannauksen komennolla:


   $ nmap 192.168.56.101 -A -p0-

Ja ajon aikana kokeilin käynnistää paketin jäljittinmen p-kirjaimella. Terminaali täyttyi nopeasti tideosta, niin suljin sen isolla P-kirjaimella. Muista ei valmiiksi asetetuista näppäimistä saa helposti esille nmapin statuksen.





## Lähteet



Tunkeutumistestaus 2024, Tero Karvinen (https://terokarvinen.com/2024/eettinen-hakkerointi-2024/)

Lyon 2009: Nmap Network Scanning: Chapter 15. Nmap Reference Guide (https://nmap.org/book/man-port-scanning-basics.html)

KKO:2003:36 Tietomurto Vahingonkorvaus - Korvauksen sovittelu 
(https://finlex.fi/fi/oikeus/kko/kko/2003/20030036)


Oracle VM Virtual Box versio 7.0.14  (https://www.virtualbox.org/)

Kali 2024.1 - 28th February, 2024 - The first 2024 Kali Rolling release. Kernel 6.6.0, Xfce 4.18.4. (https://www.kali.org/get-kali/#kali-platforms)

Metasploitable 2 (https://docs.rapid7.com/metasploit/metasploitable-2/)

Nmap man sivut (https://linux.die.net/man/1/nmap)

Nmap Runtime Interaction (https://nmap.org/book/man-runtime-interaction.html)



#### Tehnyt Roi Partanen 14.4.2024

